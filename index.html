function calculateAriseScore() {
    // --- 1. 读取所有新的输入值 ---
    const ageInput = document.getElementById('age');
    const sexInput = document.getElementById('sex');
    const cciInput = document.getElementById('cci');
    const nyhaInput = document.getElementById('nyha');
    const aodiInput = document.getElementById('aodi');
    const lvefInput = document.getElementById('lvef');
    const lvesdiInput = document.getElementById('lvesdi');
    const avsIn6MonthsInput = document.getElementById('avsIn6Months');

    // 验证所有字段是否都已填写
    const inputs = [ageInput, sexInput, cciInput, nyhaInput, aodiInput, lvefInput, lvesdiInput, avsIn6MonthsInput];
    for (let input of inputs) {
        if (!input.value) {
            alert('请填写所有必填字段！');
            return;
        }
    }

    const age = parseFloat(ageInput.value);
    const sex = sexInput.value; // 'male' or 'female'
    const cci = parseFloat(cciInput.value);
    const nyha = nyhaInput.value; // 'I', 'II', 'III', 'IV'
    const aodi = parseFloat(aodiInput.value);
    const lvef = parseFloat(lvefInput.value);
    const lvesdi = parseFloat(lvesdiInput.value);
    const avsIn6Months = avsIn6MonthsInput.value; // 'yes' or 'no'

    // --- 2. 为每个因素计算“点数”(基于PDF Figure S2 Nomogram的估算) ---

    // 辅助函数：线性插值或查找点数
    // mapping: [[值下限, 点数], [值上限, 点数]] 或 [[类别值, 点数]]
    // For linear: value, valueMin, valueMax, pointsMin, pointsMax, clampMin = true, clampMax = true
    function getPointsLinear(value, valMin, valMax, ptMin, ptMax) {
        if (value <= valMin) return ptMin;
        if (value >= valMax) return ptMax;
        return ptMin + ((value - valMin) / (valMax - valMin)) * (ptMax - ptMin);
    }

    let pointsAge = 0;
    if (!isNaN(age)) {
        // Nomogram: 20yrs ~0pts, 100yrs ~85pts
        pointsAge = getPointsLinear(Math.max(0, age), 20, 100, 0, 85);
    }

    let pointsSex = 0;
    if (sex === 'female') {
        pointsSex = 7; // 估算值
    } else { // male
        pointsSex = 0;
    }

    let pointsCCI = 0;
    if (!isNaN(cci)) {
        // Nomogram: CCI 0 ~0pts, CCI 9 ~63pts (即 CCI * 7)
        pointsCCI = getPointsLinear(Math.max(0, cci), 0, 9, 0, 63);
    }
    
    let pointsNYHA = 0;
    switch (nyha) {
        case 'I': pointsNYHA = 0; break;
        case 'II': pointsNYHA = 19; break; // 估算值
        case 'III': pointsNYHA = 32; break; // 估算值
        case 'IV': pointsNYHA = 42; break; // 估算值
        default: pointsNYHA = 0;
    }

    let pointsAoDi = 0;
    if (!isNaN(aodi)) {
        // Nomogram: AoDi 15 ~0pts, AoDi 65 ~50pts
        pointsAoDi = getPointsLinear(Math.max(0, aodi), 15, 65, 0, 50);
    }

    let pointsLVEF = 0;
    if (!isNaN(lvef)) {
        // Nomogram: LVEF 80% ~0pts, LVEF 20% ~30pts (逆向)
        // (80 - lvef) * (30 / (80-20)) = (80 - lvef) * 0.5
        pointsLVEF = getPointsLinear(Math.max(0, Math.min(100, lvef)), 20, 80, 30, 0); //注意ptMax和ptMin反过来
    }
    
    let pointsLVESDi = 0;
    if (!isNaN(lvesdi)) {
        // Nomogram: LVESDi 10 ~0pts, LVESDi 50 ~40pts
        pointsLVESDi = getPointsLinear(Math.max(0, lvesdi), 10, 50, 0, 40);
    }

    let pointsAVS = 0;
    if (avsIn6Months === 'no') {
        pointsAVS = 20; // 估算值
    } else { // yes
        pointsAVS = 0;
    }

    // --- 3. 计算总点数 ---
    let totalPoints = pointsAge + pointsSex + pointsCCI + pointsNYHA + pointsAoDi + pointsLVEF + pointsLVESDi + pointsAVS;
    totalPoints = Math.max(0, Math.round(totalPoints)); // 四舍五入到整数，确保非负

    // --- 4. 根据总点数估算生存率 (基于PDF Figure S2 Nomogram的估算) ---
    // 定义列线图的总点数到生存率的映射点 (估算值)
    // 格式: [总点数, 生存率]
    const survival1YrMap = [
        [0, 1.0], [20, 0.98], [40, 0.95], [60, 0.90], [80, 0.80], 
        [100, 0.65], [120, 0.50], [140, 0.35], [160, 0.22], [180, 0.15], [200, 0.10] // 扩展一点范围
    ];
    const survival3YrMap = [
        [0, 1.0], [20, 0.95], [40, 0.85], [60, 0.70], [80, 0.55], 
        [100, 0.40], [120, 0.25], [140, 0.15], [160, 0.10], [180, 0.05], [200, 0.02]
    ];
    const survival5YrMap = [
        [0, 1.0], [20, 0.92], [40, 0.78], [60, 0.60], [80, 0.42], 
        [100, 0.25], [120, 0.15], [140, 0.08], [160, 0.05], [180, 0.02], [200, 0.01]
    ];

    // 辅助函数：根据点数插值计算生存率
    function getSurvivalProbability(points, map) {
        if (points <= map[0][0]) return map[0][1]; // 小于等于最小点数，取最大生存率
        for (let i = 0; i < map.length - 1; i++) {
            if (points >= map[i][0] && points < map[i+1][0]) {
                const x1 = map[i][0];
                const y1 = map[i][1];
                const x2 = map[i+1][0];
                const y2 = map[i+1][1];
                return y1 + ((points - x1) / (x2 - x1)) * (y2 - y1);
            }
        }
        return map[map.length - 1][1]; // 大于等于最大点数，取最小生存率
    }

    const survival1yr